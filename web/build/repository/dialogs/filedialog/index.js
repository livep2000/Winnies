$.widget("dialogs.filedialog",$.winnies.dialogs,{version:"1.0.0",FM:null,currentDir:"",currentFile:"",options:{dialogType:"confirm",title:"Open file",startPath:"/",extFilters:[{json:".json"},{Webpage:".html"},{JavaScript:".js"}],handles:"open",fileName:null,fileBuffer:null},_cancel:function(){this._trigger("cancel",null,null)},_confirmation:function(){var a=this;"open"==this.options.handles?BVFS.fs.open(a.currentFile,"r",function(b,c){b?(a._trigger("confirm",null,{err:b,result:null}),BVFS.fs.close(c),a.close()):BVFS.fs.fstat(c,function(b,d){function e(b,d,f){f=f||g.length-h,BVFS.fs.read(c,g,b,f,d,function(b,d){h+=d,h<expected?e(h,null):(BVFS.fs.close(c),a._trigger("confirm",null,{err:b,result:{path:a.currentFile,buffer:g}}),a.close())})}if(b)a._trigger("confirm",null,{err:b,result:null}),BVFS.fs.close(c),a.close();else var f=expected=d.size,g=new BVFS.buffer(f),h=0;e(0,0)})}):"save"==this.options.handles?(a.FM.filemanager("option","saveFile",null),a._trigger("confirm",null,{err:null,result:"filestats"}),a.close()):this._trigger("confirm",null,{err:null,result:this.currentDir})},contentLoaded:function(){var a=this;"open"==this.options.handles&&(this.options.okText="Open file"),"save"==this.options.handles&&(this.options.okText="Save file"),"select"==this.options.handles&&(this.options.okText="Select directory"),this.FM=this.fec("container"),this.FM.height(this.element.height()),this.FM.filemanager({startPath:a.options.startPath,extFilters:a.options.extFilters,fileName:a.options.fileName,fileBuffer:a.options.fileBuffer,addressBar:!0,filters:!1,activatedir:function(b,c){a.currentDir=c.path;var d=!0;"open"==a.options.handles&&(d=!1),a._confirmButtonEnabled(d)},activatefile:function(b,c){a.currentFile=c.path;var d=!1;if("open"==a.options.handles)var d=!0;a._confirmButtonEnabled(d)}})},resize:function(a){this.FM.height(this.element.height()),this.FM.filemanager("option","resizeAll",a)},fec:function(a){return this.element.find("._winnies_"+this.widgetName+"_"+a)},_destroy:function(){this._super()},_trigger:function(a,b,c){"close"==a&&(this.FM.filemanager("destroy"),this.FM=null,this._destroy()),"open"==a&&this.contentLoaded(),"resize"==a&&this.resize(c),this._super(a,b,c)}});