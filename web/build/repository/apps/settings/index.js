$.widget("apps.settings",$.winnies.appDialog,{version:"1.0.0",doLog:!0,tabs:null,appTabLayout:null,apptypeselector:null,wallpaperselector:null,buttonset:null,themeselector:null,repositoryList:null,itemList:null,classLabel:null,containerDiv:null,contentReady:function(a){var b=this;this.element.css("overflow","hidden"),$(core.app).on("installed",function(a,c){$.each(c.onlyInstalled,function(a,c){console.debug(a),("wallpapers"==a||"themes"==a)&&b.update_theme_tab()}),b.update_applications_tab()}),$(core.app).on("uninstalled",function(a,c){b.update_applications_tab()}),this.buttonset=this.fec("installtype").buttonset(),this.fec("wipebutton").button().bind("click",function(){core.system.wipe()}),$("#_winnies_settings_installed").bind("click",function(){b.update_applications_tab()}),$("#_winnies_settings_repository").bind("click",function(){b.update_applications_tab()}),this.apptypeselector=this.fec("apptypes").selectmenu({select:function(a,c){b.update_applications_tab()}}),this.tabs=this.fec("tabs").tabs({activate:function(a,c){3==c.newTab.index()&&($("#_winnies_applications").height(b.tabs.height()-55),b.appTabLayout.resizeAll())}}),this.classLabel=this.uiDialog.attr("aria-labelledby"),this.containerDiv=$("#_winnies_settings_applications"),this.appTabLayout=this.containerDiv.layout({initClosed:!1,applyDefaultStyles:!0,paneClass:b.classLabel+"-pane"}),this.containerDiv.height(this.tabs.height()-55),this.appTabLayout.options.north.minSize=45,this.appTabLayout.options.north.resizable=!1,this.appTabLayout.options.north.closable=!1,this.appTabLayout.resizeAll(),this.appTabLayout.open("north"),this.themeselector=this.fec("themes"),this.themeselector.selectmenu({select:function(a,b){var c=$(this).val();core.util.setStyle(c),core.register.setSetting("desktop","theme",c)}}).selectmenu("menuWidget").addClass("themarolleroverflow"),this.wallpaperselector=this.fec("wallpapers"),this.wallpaperselector.selectmenu({select:function(a,b){var c=$(this).val();core.util.setBackground(c),core.register.setSetting("desktop","wallpaper",c)}}).selectmenu("menuWidget").addClass("themarolleroverflow"),this.itemList=this.fec("itemlist"),this.itemList.selectable({unselected:function(){$(":not(.ui-selected)",this).each(function(){$(this).removeClass("ui-state-highlight")})},stop:function(){b.fec("details").empty(),$(".ui-selected",this).each(function(){$(this).addClass("ui-state-highlight");var a=$(this).attr("appName"),c=$(this).attr("category"),d=b.buttonset.find("[name=installtype]:checked").val();if(c&&a){var e={};e="repository"==d?b.repositoryList[c][a]:BVFS.installedObject[c][a],b.update_detail_pane(e,a,d)}})}}).find("li").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),this.update_theme_tab(),this.update_applications_tab()},update_theme_tab:function(){var a=[];this.themeselector.empty(),$.each(BVFS.installedObject.themes,function(b,c){a.push("<option value='"+b+"'>"+c.title+"</option>")}),this.themeselector.append(a.join("")).selectmenu(),this.themeselector.val(core.register.getSetting("desktop","theme")).selectmenu("refresh");var a=[];this.wallpaperselector.empty(),$.each(BVFS.installedObject.wallpapers,function(b,c){a.push("<option value='"+b+"'>"+c.title+"</option>")}),this.wallpaperselector.append(a.join("")).selectmenu(),this.wallpaperselector.val(core.register.getSetting("desktop","wallpaper")).selectmenu("refresh")},update_applications_tab:function(){var a=this;if(this.fec("details").empty(),this.itemList.empty(),"repository"==this.buttonset.find("[name=installtype]:checked").val()){var b=BVFS.host.origin+"/repository/boot/repositorycontent.json";BVFS.wread(b,function(b,c){a.repositoryList=a.filterInstalledOutRepository(JSON.parse(c).items),a.showListInPane(a.repositoryList)})}else this.showListInPane(BVFS.installedObject)},showListInPane:function(a){var b=this,c=this.filterAppsBy(a,this.apptypeselector.val());$.each(c,function(a,c){$.each(c,function(c,d){var e=b.createAppItem(c,a,d);b.itemList.append(e)})})},update_detail_pane:function(a,b,c){var d=this.fec("details"),e=core.register.getSetting("winnies","roles"),f="Uninstall";"repository"==c&&(f="Install");var g=$("<button>");g.button({label:f}).click(function(a,d){"repository"==c?core.app.install(b):core.app.uninstall(b)}),g.css("width","100%"),d.append(g),d.append("<br/><br/>");var h=$("<div>"),i=$("<span style='font-weight:bold;' />");i.text("appName: "),h.append(i);var j=$("<span />");j.text(b),h.append(j),d.append(h),$.each(a,function(a,b){if("dim"!==a&&"files"!==a){var c=$("<div>"),f=$("<span style='font-weight:bold;' />");if(f.text(a+": "),c.append(f),"object"==typeof b)"author"==a&&$.each(b,function(a,b){var e=$("<span />");e.text(">>>> "+a+": "+b),c.append($("<br>")),c.append(e),d.append(c)});else{var g=$("<span />");"minimumRole"==a?g.text(e[b]):g.text(b),c.append(g),d.append(c)}}}),d.append("<br/>")},createAppItem:function(a,b,c){var d=$("<div>");d.attr({appName:a,category:b}),d.addClass("ui-state-default");var e=$("<span>");e.addClass("ui-icon"),e.addClass(c.icon),e.css("display","inline-block");var f=$("<span>");return f.css("display","inline-block"),f.text(c.title),d.append(e),d.append(f),d},filterInstalledOutRepository:function(a){return $.each(a,function(b,c){$.each(c,function(c,d){BVFS.installedObject[b]&&BVFS.installedObject[b][c]&&(a[b][c]=null,delete a[b][c])})}),a},filterAppsBy:function(a,b){if("all"===b)return a;var c={};return $.each(a,function(a,d){a==b&&(c[a]=d)}),c},_init:function(){this._super()},_create:function(){this._super()},_setOption:function(a,b){this._super(a,b)},_setOptions:function(a){this._super(a)},_destroy:function(){this._super()},fec:function(a){return this.element.find("._winnies_"+this.widgetName+"_"+a)},resize:function(a){this.tabs.width(a.size.innerWidth+5),this.tabs.height(a.size.innerHeight+5),this.containerDiv.height(this.tabs.height()-55),this.appTabLayout.resizeAll()},_trigger:function(a,b,c){"close"==a&&this._destroy(),"contentLoaded"==a&&(this.contentReady(c),this.resize(c)),"resize"==a&&this.resize(c),this._super(a,b,c)}});