$.widget("apps.player",$.winnies.appDialog,{version:"1.0.0",doLog:!0,ms:null,maxChunkSize:10240,readAhead:4,available:!1,_create:function(){this._super()},play:function(a,b){function c(a,g,h){var i=e;if((g+1)*e>h)var i=h-g*e;var j=new BVFS.buffer(i),k=g*e;BVFS.fs.read(a,j,0,h,k,function(i,k){f.appendBuffer(j),g+=1,1==g&&d.player.play(),h>g*e?c(a,g,h):(BVFS.fs.close(a),b(null,"ready"))})}var d=this,e=d.maxChunkSize,f=this.ms.addSourceBuffer('video/webm; codecs="vorbis"');this.openFd(a,function(a,b,d){console.debug("Play size "+d),c(b,0,d)})},openFd:function(a,b){BVFS.fs.open(a,"r",function(a,c){return a?b(a,null):void BVFS.fs.fstat(c,function(a,d){return a?b(a,null):void b(null,c,d.size)})})},createToolbar:function(){$("#play").button({text:!1,icons:{primary:"ui-icon-play"}}).click(function(){console.debug("CLICK");var a;a="play"===$(this).text()?{label:"pause",icons:{primary:"ui-icon-pause"}}:{label:"play",icons:{primary:"ui-icon-play"}},$(this).button("option",a)}),$("#beginning").button({text:!1,icons:{primary:"ui-icon-seek-start"}}),$("#rewind").button({text:!1,icons:{primary:"ui-icon-seek-prev"}}),$("#stop").button({text:!1,icons:{primary:"ui-icon-stop"}}).click(function(){$("#play").button("option",{label:"play",icons:{primary:"ui-icon-play"}})}),$("#forward").button({text:!1,icons:{primary:"ui-icon-seek-next"}}),$("#end").button({text:!1,icons:{primary:"ui-icon-seek-end"}}),$("#shuffle").button(),$("#repeat").buttonset()},contentLoaded:function(a){this.player=new MediaElementPlayer("#_winnies_player_video",{videoWidth:a.size.innerWidth-10,videoHeight:a.size.innerHeight-10,enableAutosize:!0,success:function(a,b){$("#"+b.id+"-mode").html("mode: "+a.pluginType)}}),this.resize(a)},resize:function(a){$("#_winnies_player_video").width(a.size.innerWidth-10),$("#_winnies_player_video").height(a.size.innerHeight-10)},_setOption:function(a,b){this._super(a,b)},_setOptions:function(a){this._super(a)},_destroy:function(){this._super()},fic:function(a){return this.element.find("."+this.widgetName+"_"+a)},_trigger:function(a,b,c){"close"==a&&this._destroy(),"resizeStop"==a&&this.resize(c),"contentLoaded"==a&&this.contentLoaded(c),this._super(a,b,c)},logging:function(a){this.doLog&&oldConsole.log(this.widgetname+" :: "+a)}});