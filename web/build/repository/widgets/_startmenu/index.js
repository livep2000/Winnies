var hoverTimer=null;$.widget("widgets._startmenu",$.winnies.widgetSuperwidget,{version:"1.0.0",doLog:!0,accMenu:null,menuHandle:null,cattItems:null,tempTopOffset:0,_init:function(){this._super()},_create:function(){var a=this;this.element.addClass("ontop"),$(core.app).on("installed",function(b,c){c.onlyInstalled.apps&&$.each(c.onlyInstalled.apps,function(b,c){var d=BVFS.installedObject.apps[b];a.addMenuItem(d,b,function(c,d){a.logging("Create a startmenu button for: "+b)})})}),$(core.app).on("uninstalled",function(b,c){c.onlyUninstalled.apps&&$.each(c.onlyUninstalled.apps,function(b,c){a.removeMenuItem(b,function(c,d){a.logging("Removed a startmenu button for: "+b)})})});var b=this.element.find("._winnies_startmenuhandler");b.addClass("ui-dialog-title"),b.mouseenter(this.handlerIn),this.cattItems={},this.accMenu=this.element.find("._startmenu_startmenu_accordion"),this.accMenu.accordion({collapsible:!0,heightStyle:"content"}),this.accMenu.mouseleave(this.handlerOut),this.accMenu.mouseenter(this.handlerIn);var c=BVFS.installedObject.apps,d=BVFS.authentication.user.ROL;for(appName in c){var e=c[appName];e.minimumRole||(e.minimumRole=0),e.minimumRole<=d&&this.addMenuItem(e,appName)}this.element.appendTo("body"),this._super()},removeMenuItem:function(a){var b=BVFS.installedObject.apps,c=b[a],d=c.category;this.cattItems[d]&&this.cattItems[d].buttons[a]&&(this.cattItems[d].buttons[a].remove(),this.cattItems[d].buttons[a]=null,delete this.cattItems[d].buttons[a],0==Object.keys(this.cattItems[d].buttons).length&&($("div[name='"+d+"']").remove(),$("h3[name='"+d+"']").remove(),this.cattItems[d]=null,delete this.cattItems[d]),this.accMenu.accordion("refresh"))},addMenuItem:function(a,b){var c=a.category;if(c||(c="Overig"),this.cattItems[c]){var d=this.cattItems[c].catId,e=this.element.find("#"+d),f=this.createButton(a,b);this.cattItems[c].buttons[b]={},this.cattItems[c].buttons[b]=f;var g=!1,h=e.find("button[name]");$.each(h,function(a,c){var d=$(c).attr("name");0==g&&d.toLowerCase()>b.toLowerCase()&&(f.insertBefore($(c)),g=!0)}),0==g&&e.append(f),this.accMenu.accordion("refresh")}else{this.cattItems[c]={},this.cattItems[c].buttons={};var f=this.createButton(a,b);this.cattItems[c].buttons[b]=f;var d=this.createCategory(c,f);this.cattItems[c].catId=d,this.cattItems[c].headerId=d}},handlerIn:function(a,b){clearTimeout(hoverTimer),$("._startmenu_startmenu_accordion").fadeIn(500)},handlerOut:function(a,b){hoverTimer=setTimeout(function(){$("._startmenu_startmenu_accordion").fadeOut(1e3)},3e3)},createButton:function(a,b){var c=$("<button>");return c.width(180),c.attr("name",b),c.button({icons:{primary:a.icon},label:a.title}).click(function(){core.app.launch($(this)[0].name,function(a,b){})}),c},createCategory:function(a,b){var c=($(""),$("<h3>"));c.text(a),c.attr("name",a);var d=$("<div>");d.append(b);var e=!1,f=this.accMenu.find("h3[name]");return $.each(f,function(b,f){var g=$(f).attr("name");g.toLowerCase()>a.toLowerCase()&&0==e&&(d.insertBefore($(f)),c.insertBefore(d),e=!0)}),0==e&&(this.accMenu.append(c),d.insertAfter(c)),this.accMenu.accordion("refresh"),d.attr("id")},_setOption:function(a,b){this._super(a,b)},_setOptions:function(a){this._super(a)},_destroy:function(){this._super()},logging:function(a){this.doLog&&console.log("_startmenu :: "+a)},_trigger:function(a,b,c){"close"==a&&this._destroy(),this._super(a,b,c)}});